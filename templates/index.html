<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>City Layers - Chat to Map</title>
    <link rel="stylesheet" href="/static/css/styles.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" />
    <link rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script>
    <!-- deck.gl standalone bundle -->
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
    <!-- H3 library for hexagonal spatial indexing -->
    <script src="https://unpkg.com/h3-js@4.1.0/dist/h3-js.umd.js"></script>
    <!-- Marked.js for markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.0/marked.min.js"></script>
    <script>
        window.MAPBOX_TOKEN = "{{ mapbox_token }}";
    </script>
</head>

<body>
    <button id="expandBtn" class="expand-btn" aria-label="Expand panel">▶</button>
    <div class="main-map">
        <div class="left-container">
            <div class="resize-handle"></div>
            <div class="panel category">
                <div class="configheader">
                    <div class="text">
                        <div class="logo-container" style="text-align: center; padding: 10px;">
                            <img src="/static/images/city_layers_logo.png" alt="City Layers Logo"
                                style="max-width: 100%; height: 40px;">
                        </div>
                    </div>
                </div>
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <input type="text" id="placeSearchInput" class="place-search-input"
                            placeholder="Search places..." autocomplete="off" />
                        <button type="button" id="clearSearchBtn" class="clear-search-btn"
                            title="Clear search">×</button>
                    </div>
                    <div id="searchResults" class="search-results"></div>
                </div>
                <div id="categoryFilter" class="category-filter-inline">
                    <div class="filter-header-inline">
                        <span>Filter by Category:</span>
                    </div>
                    <div class="filter-controls horizontal">
                        <div class="select-wrapper">
                            <select id="categorySelect" class="category-select minimal-select">
                                <option value="all">All Points</option>
                            </select>
                            <div class="select-arrow"></div>
                        </div>
                        <button type="button" id="applyFilterBtn" class="filter-apply-btn">Filter</button>
                    </div>
                </div>
                <div class="controllercontainer">
                    <div class="subcontainer vis-options-row">
                        <div class="vischoice selected" data-mode="mapbox" id="viz-mapbox" title="Map View">
                            <svg class="viz-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                        </div>
                        <div class="vischoice" data-mode="scatter" id="viz-scatter" title="Scatter Plot">
                            <svg class="viz-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="2"></circle>
                                <circle cx="19" cy="19" r="2"></circle>
                                <circle cx="5" cy="19" r="2"></circle>
                                <circle cx="5" cy="5" r="2"></circle>
                                <circle cx="19" cy="5" r="2"></circle>
                            </svg>
                        </div>
                        <div class="vischoice" data-mode="heatmap" id="viz-heatmap" title="Heatmap">
                            <svg class="viz-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <circle cx="15.5" cy="8.5" r="1.5"></circle>
                                <circle cx="8.5" cy="15.5" r="1.5"></circle>
                                <circle cx="15.5" cy="15.5" r="1.5"></circle>
                            </svg>
                        </div>
                        <div class="vischoice" data-mode="arc" id="viz-arc" title="Arc Connection">
                            <svg class="viz-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                        </div>
                        <div class="vischoice" data-mode="chloropleth" id="viz-chloropleth" title="Choropleth">
                            <svg class="viz-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 7l6-3 6 3 6-3v13l-6 3-6-3-6 3V7z"></path>
                                <path d="M9 4v13"></path>
                                <path d="M15 7v13"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="categorycontainer chat-container">
                    <div id="chatWindow" class="chat-window">
                        <div class="system">Ask questions about places in the database.</div>
                    </div>
                    <button id="scrollBottomBtn" class="scroll-bottom-btn d-none"
                        aria-label="Scroll to bottom"></button>
                    <form id="chatForm" class="chat-form">
                        <button type="button" class="draw-region-icon-btn" id="drawRectangleBtn"
                            title="Draw region on map">
                            <div class="rectangle-icon-small"></div>
                        </button>
                        <input id="chatInput" type="text" placeholder="Type your message..." autocomplete="off" />
                        <button type="submit">Send</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="right-container">
            <div id="map" class="mappanel"></div>
            <div id="map-overlay-panel" class="map-overlay-panel hidden">
                <div class="overlay-header">
                    <span id="overlay-category">Category</span>
                </div>
                <div id="overlay-legend" class="overlay-legend"></div>
            </div>
            <div id="dataSources" class="data-sources-panel">
                <div class="data-sources-header">Data Sources</div>
                <div class="data-sources-list">
                    <button class="data-source-btn active" id="source-citylayers" data-source="citylayers" title="CityLayers - Location data from Neo4j database">
                        <img src="/static/images/city_layers_logo.png" alt="CityLayers" class="source-icon-img">
                    </button>
                    <button class="data-source-btn" id="source-weather" data-source="weather" title="Weather - Temperature and climate data">
                        <svg class="source-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="locationCount" class="location-count-panel">
                <div class="location-count-header">Locations on Map</div>
                <div class="location-count-value">0</div>
            </div>
            <div id="temperaturePanel" class="temperature-panel hidden">
                <div class="temperature-header">Average Temperature</div>
                <div class="temperature-value">--°C</div>
                <div class="temperature-hover-info"></div>
            </div>
            <div id="mapControls" class="map-controls-panel">
    <label class="theme-switch" title="Toggle Dark/Light Mode">
        <input type="checkbox" id="themeToggleCheckbox" onchange="toggleTheme()">
        <span class="slider round" data-icon="moon"></span>
    </label>
    <label class="theme-switch" title="Toggle Buildings">
        <input type="checkbox" id="buildingsToggleCheckbox" checked onchange="toggleBuildings()">
        <span class="slider round" data-icon="building"></span>
    </label>
    <button class="map-control-btn" id="clearMapBtn" title="Clear all locations from map">
        <div class="control-icon trash-icon"></div>
    </button>
</div>
        </div>
    </div>

    <!-- Weather Details Slide-in Panel -->
    <div id="weatherDetailsPanel" class="weather-details-panel">
        <div class="weather-details-header">
            <h3 id="weatherDetailsTitle">Location Weather</h3>
            <button id="closeWeatherDetails" class="close-weather-btn">×</button>
        </div>
        <div class="weather-details-content">
            <div class="weather-section">
                <h4>Current Temperature</h4>
                <div id="currentTemp" class="weather-value large">--°C</div>
            </div>
            
            <div class="weather-section">
                <h4>Yearly Temperature Graph</h4>
                <canvas id="temperatureChart" width="400" height="200"></canvas>
            </div>
            
            <div class="weather-section">
                <h4>Wind Speed</h4>
                <div id="windSpeed" class="weather-value">-- km/h</div>
            </div>
            
            <div class="weather-section">
                <h4>Precipitation</h4>
                <div id="precipitation" class="weather-value">-- mm</div>
            </div>
            
            <div class="weather-section">
                <h4>Humidity</h4>
                <div id="humidity" class="weather-value">-- %</div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>

</html>